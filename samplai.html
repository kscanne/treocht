<div class="foirm">
  <div class="treoracha">Roinnt de na samplaí is spéisiúla!</div>
  <div class="uicol">
    Treochtaí:</br>
    <a href="javascript:void(0);" onclick="return processClick('breatimeacht|sasamach|brexit','treocht');">Breatimeacht v. Sasamach v. Brexit</a><br/>
  </div>
  <div class="uicol">
    Léarscáileanna:</br>
    <a href="javascript:void(0);" onclick="return processClick('cloisteáil|cloisint|cluinstin','atlas');">cloisteáil v. cloisint v. cluinstin</a><br/>
  </div>
</div>
<hr/>
<div id="output"></div>
<div id="map"></div>

<script>
  google.charts.load('current', {'packages':['corechart'], 'language': 'ga'});
  function processClick(query, outputType) {
    var XHR = new XMLHttpRequest();

    XHR.onreadystatechange = function(event) {
      if (XHR.readyState == XMLHttpRequest.DONE) {
        if (XHR.status == 200) {
          if (outputType == 'treocht') {
            processTrendsJSON(JSON.parse(event.target.responseText));
          }
          else {
            processMapJSON(JSON.parse(event.target.responseText));
          }
        }
        else {
          var div=document.getElementById("output");
          div.innerHTML=XHR.status.toString()+': '+XHR.statusText;
        }
      }
    };

    XHR.open("POST", 'https://cadhan.com/api/' + outputType + '/1.0');
    XHR.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    XHR.setRequestHeader('Accept','application/json');
    var payload = 'teacs=' + encodeURIComponent(query);
    XHR.send(payload);
  }

  function processTrendsJSON(arr) {
    document.getElementById('map').innerHTML='';
    document.getElementById('map').removeAttribute('style');
    var div=document.getElementById("output");
    div.innerHTML='';
    for(var i=1; i<arr.length; i++) {
      var year = parseInt(arr[i][0].substring(0,4));
      var month = parseInt(arr[i][0].substring(5));
      arr[i][0] = new Date(year, month-1);
	}
    var data = new google.visualization.DataTable();
    data.addColumn('date', 'Dáta');
    for(var i=1; i<arr[0].length; i++) {
      data.addColumn('number', arr[0][i]);
    }
    arr.shift(); // remove header row
    data.addRows(arr);
    // DateFormat doesn't take locale code AFAICT
    var date_formatter = new google.visualization.DateFormat({pattern: "y-MM"});
    date_formatter.format(data, 0);
    var options = {
            width: 800,
            height: 500,
            explorer: {},
           hAxis: {
            format: 'y-MM'
            },
           vAxis: {
            title: 'líon sa milliún focal',
            minValue: 0
            },
          legend: { position: 'bottom' },
          chartArea: {'left':75,'top':13,'width': '75%', 'height': '75%'},
          colors: ['#6B94FA', '#FB766B', '#24E456', '#FD9827', '#8E6CF9']
    };
    var chart = new google.visualization.LineChart(div);
    chart.draw(data,options);
    }

  function processMapJSON(arr) {
    document.getElementById("output").innerHTML = '';
    var div = document.getElementById('map');
    div.style.height = "700px";
    div.style.width = "520px";
    div.style.overflow = "hidden";
    div.style.float = "left";
    div.style.border = "thin solid #333";
    var map = new google.maps.Map(document.getElementById('map'), {
       center: new google.maps.LatLng(53.45,-7.9),
       zoom: 7,
       mapTypeId: 'terrain'
    });
    for (var i=0; i < arr.length; i++) {
      var marker = new google.maps.Marker({
        position: arr[i]['coords'],
        map: map,
        title: arr[i]['label'],
        icon: 'pic/' + arr[i]['color'] + '.png'
       });
    }
  }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCbvTaQOUkXHtNGagDGR2-rrcfEC4yYUrE&language=ga&region=IE"></script>
